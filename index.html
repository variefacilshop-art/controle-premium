<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Premium</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
}
header {
  background: #020617;
  padding: 20px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}
main {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}
.card {
  background: #020617;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
}
button, input, select {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 6px;
  border: none;
  font-size: 16px;
}
button {
  background: #38bdf8;
  font-weight: bold;
  cursor: pointer;
}
button:hover { background: #0ea5e9; }
.hidden { display: none; }
.total {
  font-size: 22px;
  font-weight: bold;
  text-align: right;
  color: #22c55e;
}
</style>
</head>

<body>

<header>üíé Controle Premium</header>

<main>

<div class="card" id="login">
  <h2>Entrar</h2>
  <button onclick="loginGoogle()">Entrar com Google</button>
</div>

<div id="app" class="hidden">

  <div class="card">
    <button onclick="logout()">Sair</button>
  </div>

  <div class="card">
    <h2>Novo Lan√ßamento</h2>
    <select id="tipo">
      <option value="entrada">Entrada</option>
      <option value="saida">Sa√≠da</option>
    </select>
    <input id="descricao" placeholder="Descri√ß√£o">
    <input id="valor" type="number" placeholder="Valor (R$)">
    <button onclick="adicionar()">Adicionar</button>
  </div>

  <div class="card">
    <h2>Movimenta√ß√µes</h2>
    <table width="100%">
      <thead>
        <tr><th>Tipo</th><th>Descri√ß√£o</th><th>Valor</th></tr>
      </thead>
      <tbody id="lista"></tbody>
    </table>
    <div class="total" id="saldo">Saldo: R$ 0,00</div>
  </div>

</div>

</main>

<script>
const supabase = supabaseJs.createClient(
  "https://ssnabfzwfvcmwkgibvec.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzbmFiZnp3ZnZjbXdrZ2lidmVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTE1MjcsImV4cCI6MjA4NTYyNzUyN30.s02EFB4FRopxB7Ak7zWUSkINcGY5ESRn7SLbDXn0Wbo"
);

let user = null;

async function loginGoogle() {
  await supabase.auth.signInWithOAuth({ provider: "google" });
}

async function logout() {
  await supabase.auth.signOut();
  location.reload();
}

supabase.auth.onAuthStateChange(async (_, session) => {
  if (session) {
    user = session.user;
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    carregar();
  }
});

function formatar(v) {
  return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

async function carregar() {
  const { data } = await supabase
    .from("movimentacoes")
    .select("*")
    .eq("user_id", user.id);

  renderizar(data || []);
}

async function adicionar() {
  const tipo = tipoEl.value;
  const descricao = descricaoEl.value;
  const valor = parseFloat(valorEl.value);

  if (!descricao || isNaN(valor)) return;

  await supabase.from("movimentacoes").insert({
    user_id: user.id,
    tipo, descricao, valor
  });

  descricaoEl.value = "";
  valorEl.value = "";
  carregar();
}

function renderizar(lista) {
  listaEl.innerHTML = "";
  let saldo = 0;

  lista.forEach(m => {
    saldo += m.tipo === "entrada" ? m.valor : -m.valor;
    listaEl.innerHTML += `
      <tr>
        <td>${m.tipo}</td>
        <td>${m.descricao}</td>
        <td>${formatar(m.valor)}</td>
      </tr>`;
  });

  saldoEl.innerText = "Saldo: " + formatar(saldo);
}

const tipoEl = document.getElementById("tipo");
const descricaoEl = document.getElementById("descricao");
const valorEl = document.getElementById("valor");
const listaEl = document.getElementById("lista");
const saldoEl = document.getElementById("saldo");
</script>

</body>
</html>
